<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checkout ‚Äì Pacific Seller's</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="toast" id="toast"></div>

<!-- NAV -->
<nav>
  <a class="nav-logo" href="index.html" id="navLogo"></a>
  <div class="nav-links">
    <a class="nav-btn" href="cart.html">‚Üê Back to Cart</a>
  </div>
</nav>

<!-- CHECKOUT CONTENT -->
<div class="checkout-wrap">
  <div class="page-section-title" style="margin-bottom:24px;">Secure <span>Checkout</span></div>
  <div class="checkout-grid">
    <!-- LEFT: Forms -->
    <div>
      <!-- COD Box -->
      <div class="checkout-card">
        <div class="checkout-title">üíµ Payment <span>Method</span></div>
        <div class="cod-box">
          <div class="cod-icon">üíµ</div>
          <div class="cod-text">
            <strong>Cash on Delivery (COD)</strong>
            <span>Pay in cash when your order arrives at your doorstep. Safe & convenient.</span>
          </div>
        </div>
      </div>

      <!-- Contact Info -->
      <div class="checkout-card">
        <div class="checkout-title">üë§ Contact <span>Information</span></div>
        <div class="form-row-2">
          <div class="co-form-group">
            <label>Full Name *</label>
            <input type="text" id="co_name" placeholder="Your full name" required>
          </div>
          <div class="co-form-group">
            <label>Phone Number *</label>
            <input type="tel" id="co_phone" placeholder="+91 98765 43210" required>
          </div>
        </div>
        <div class="co-form-group">
          <label>Email Address</label>
          <input type="email" id="co_email" placeholder="email@example.com">
        </div>
      </div>

      <!-- Billing Address -->
      <div class="checkout-card">
        <div class="checkout-title">üè† Billing <span>Address</span></div>
        <div class="co-form-group">
          <label>Address Line 1 *</label>
          <input type="text" id="bill_addr1" placeholder="House no., Building, Street" required>
        </div>
        <div class="co-form-group">
          <label>Address Line 2</label>
          <input type="text" id="bill_addr2" placeholder="Area, Landmark (optional)">
        </div>
        <div class="form-row-2">
          <div class="co-form-group"><label>City *</label><input type="text" id="bill_city" placeholder="City" required></div>
          <div class="co-form-group"><label>State *</label><input type="text" id="bill_state" placeholder="State" required></div>
        </div>
        <div class="form-row-2">
          <div class="co-form-group"><label>Pincode *</label><input type="text" id="bill_pin" placeholder="600001" required maxlength="6"></div>
          <div class="co-form-group"><label>Country</label><input type="text" id="bill_country" value="India" readonly></div>
        </div>
      </div>

      <!-- Same Address Checkbox -->
      <label class="same-addr-label">
        <input type="checkbox" id="sameAddr" onchange="toggleShipAddr()" checked>
        <span>‚úÖ Shipping address is same as billing address</span>
      </label>

      <!-- Shipping Address (hidden by default) -->
      <div class="checkout-card" id="shipFields" style="display:none;">
        <div class="checkout-title">üöö Shipping <span>Address</span></div>
        <div class="co-form-group">
          <label>Address Line 1 *</label>
          <input type="text" id="ship_addr1" placeholder="House no., Building, Street">
        </div>
        <div class="co-form-group">
          <label>Address Line 2</label>
          <input type="text" id="ship_addr2" placeholder="Area, Landmark (optional)">
        </div>
        <div class="form-row-2">
          <div class="co-form-group"><label>City *</label><input type="text" id="ship_city" placeholder="City"></div>
          <div class="co-form-group"><label>State *</label><input type="text" id="ship_state" placeholder="State"></div>
        </div>
        <div class="form-row-2">
          <div class="co-form-group"><label>Pincode *</label><input type="text" id="ship_pin" placeholder="600001" maxlength="6"></div>
          <div class="co-form-group"><label>Country</label><input type="text" id="ship_country" value="India" readonly></div>
        </div>
      </div>
    </div>

    <!-- RIGHT: Order Summary -->
    <div class="order-summary">
      <div class="checkout-card" style="margin-bottom:0">
        <div class="checkout-title">üßæ Order <span>Summary</span></div>
        <div id="summaryItems"></div>
        <hr class="summary-divider">
        <div class="summary-row"><span>Subtotal</span><span id="summarySubtotal">‚Äî</span></div>
        <div class="summary-row"><span>Shipping</span><span id="summaryShipping">‚Äî</span></div>
        <div class="summary-row"><span>Payment Mode</span><span style="color:var(--green);font-weight:700">COD</span></div>
        <hr class="summary-divider">
        <div class="summary-total-row"><span>Total Payable</span><span id="summaryTotal">‚Äî</span></div>
        <div id="freeShipMsg" style="display:none;text-align:center;margin-top:8px;font-size:11px;color:var(--green);">üéâ You saved ‚Çπ49 on shipping!</div>
        <button class="btn-place-order" onclick="placeOrder()">Place Order ‚Üí</button>
        <p style="text-align:center;font-size:11px;color:var(--gray);margin-top:8px;">Pay cash on delivery ¬∑ No advance needed</p>
      </div>
    </div>
  </div>
</div>

<script src="app.js"></script>
<script>
document.getElementById('navLogo').innerHTML = navLogoSVG();

let checkoutItems = [];

function toggleShipAddr() {
  document.getElementById('shipFields').style.display =
    document.getElementById('sameAddr').checked ? 'none' : 'block';
}

function loadCheckout() {
  const cart = getCart();
  const buyNowId = sessionStorage.getItem('ps_buynow');

  if (buyNowId) {
    sessionStorage.removeItem('ps_buynow');
    const p = getDB('products').find(x => x.id == buyNowId);
    if (p) {
      checkoutItems = [{ id: p.id, name: p.name, price: p.price, image: p.image || p.imageUrl, category: p.category, qty: 1 }];
    }
  } else {
    checkoutItems = [...cart];
  }

  if (!checkoutItems.length) {
    window.location.href = 'index.html';
    return;
  }

  const subtotal = checkoutItems.reduce((s, i) => s + i.price * i.qty, 0);
  const shipping = subtotal > 999 ? 0 : 49;
  const total = subtotal + shipping;

  document.getElementById('summaryItems').innerHTML = checkoutItems.map(i => `
    <div class="summary-item">
      ${i.image ? `<img class="summary-item-img" src="${i.image}" onerror="this.style.display='none'">` : `<div class="summary-item-img-ph">üõí</div>`}
      <div class="summary-item-name">${i.name}<br><small style="color:var(--gray);font-weight:400">Qty: ${i.qty}</small></div>
      <div class="summary-item-price">‚Çπ${(i.price * i.qty).toLocaleString()}</div>
    </div>`).join('');

  document.getElementById('summarySubtotal').textContent = '‚Çπ' + subtotal.toLocaleString();
  document.getElementById('summaryShipping').innerHTML = shipping === 0
    ? '<span style="color:var(--green);font-weight:700">FREE</span>'
    : '‚Çπ' + shipping;
  document.getElementById('summaryTotal').textContent = '‚Çπ' + total.toLocaleString();
  if (shipping === 0) document.getElementById('freeShipMsg').style.display = 'block';

  // Store total for placeOrder
  window._checkoutTotal = total;
}

function placeOrder() {
  const name = document.getElementById('co_name').value.trim();
  const phone = document.getElementById('co_phone').value.trim();
  const addr1 = document.getElementById('bill_addr1').value.trim();
  const city = document.getElementById('bill_city').value.trim();
  const state = document.getElementById('bill_state').value.trim();
  const pin = document.getElementById('bill_pin').value.trim();

  if (!name || !phone || !addr1 || !city || !state || !pin) {
    showToast('‚ö†Ô∏è Please fill all required fields');
    return;
  }
  if (phone.replace(/\D/g, '').length < 10) {
    showToast('‚ö†Ô∏è Please enter a valid phone number');
    return;
  }
  if (pin.length < 6) {
    showToast('‚ö†Ô∏è Please enter a valid 6-digit pincode');
    return;
  }

  const same = document.getElementById('sameAddr').checked;

  // Validate shipping address if different
  if (!same) {
    const sAddr1 = document.getElementById('ship_addr1').value.trim();
    const sCity = document.getElementById('ship_city').value.trim();
    const sState = document.getElementById('ship_state').value.trim();
    const sPin = document.getElementById('ship_pin').value.trim();
    if (!sAddr1 || !sCity || !sState || !sPin) {
      showToast('‚ö†Ô∏è Please fill the shipping address fields');
      return;
    }
  }

  const billing = {
    addr1, addr2: document.getElementById('bill_addr2').value,
    city, state, pin, country: 'India'
  };
  const shipping = same ? { ...billing } : {
    addr1: document.getElementById('ship_addr1').value,
    addr2: document.getElementById('ship_addr2').value,
    city: document.getElementById('ship_city').value,
    state: document.getElementById('ship_state').value,
    pin: document.getElementById('ship_pin').value,
    country: 'India'
  };

  const orderId = 'PS' + Date.now().toString().slice(-8);
  const orders = getDB('orders');
  orders.push({
    id: orderId, name, phone,
    email: document.getElementById('co_email').value,
    billing, shipping,
    items: checkoutItems.map(i => i.name + ' x' + i.qty).join(', '),
    itemCount: checkoutItems.reduce((s, i) => s + i.qty, 0),
    total: window._checkoutTotal,
    payment: 'COD',
    status: 'Pending',
    date: new Date().toISOString().split('T')[0]
  });
  setDB('orders', orders);

  // Clear cart
  saveCart([]);

  // Store success info for thank you page
  sessionStorage.setItem('ps_order_success', JSON.stringify({
    orderId, name, phone,
    total: window._checkoutTotal,
    shipping: shipping
  }));

  window.location.href = 'thankyou.html';
}

window.addEventListener('DOMContentLoaded', loadCheckout);
</script>
</body>
</html>
